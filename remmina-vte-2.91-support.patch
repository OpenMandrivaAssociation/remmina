$OpenBSD: patch-cmake_FindVTE_cmake,v 1.1 2014/10/06 07:27:05 jasper Exp $

Adjust to new VTE 2.91 API

Index: FreeRDP-Remmina-356c033/cmake/FindVTE.cmake
===================================================================
--- FreeRDP-Remmina-356c033.orig/cmake/FindVTE.cmake
+++ FreeRDP-Remmina-356c033/cmake/FindVTE.cmake
@@ -21,12 +21,10 @@ if(NOT _VTE_VERSION_NUM)
 	set(_VTE_LIB_NAME vte)
 	set(_VTE_VERSION vte)
 else()
-	set(_VTE_LIB_NAME vte${_VTE_VERSION_NUM})
+	set(_VTE_LIB_NAME vte-${_VTE_VERSION_NUM})
 	set(_VTE_VERSION vte-${_VTE_VERSION_NUM})
 endif()
 
-string(REPLACE . _ _VTE_LIB_NAME ${_VTE_LIB_NAME})
-
 pkg_check_modules(PC_VTE ${_VTE_VERSION})
 
 find_path(VTE_INCLUDE_DIR NAMES vte/vte.h
Index: FreeRDP-Remmina-356c033/remmina/CMakeLists.txt
===================================================================
--- FreeRDP-Remmina-356c033.orig/remmina/CMakeLists.txt
+++ FreeRDP-Remmina-356c033/remmina/CMakeLists.txt
@@ -120,7 +120,7 @@ if(AVAHI_FOUND)
 endif()
 
 if(GTK3_FOUND)
-	set(_VTE_VERSION_NUM 2.90)
+	set(_VTE_VERSION_NUM 2.91)
 else()
 	set(_VTE_VERSION_NUM)
 endif()
Index: FreeRDP-Remmina-356c033/remmina/src/remmina_ssh_plugin.c
===================================================================
--- FreeRDP-Remmina-356c033.orig/remmina/src/remmina_ssh_plugin.c
+++ FreeRDP-Remmina-356c033/remmina/src/remmina_ssh_plugin.c
@@ -122,9 +122,10 @@ remmina_plugin_ssh_main_thread (gpointer
 	THREADS_ENTER
 	if (charset && charset[0] != '\0')
 	{
-		vte_terminal_set_encoding (VTE_TERMINAL (gpdata->vte), charset);
+		vte_terminal_set_encoding (VTE_TERMINAL (gpdata->vte), charset, NULL);
 	}
-	vte_terminal_set_pty (VTE_TERMINAL (gpdata->vte), shell->slave);
+	vte_terminal_set_pty (VTE_TERMINAL (gpdata->vte),
+	    vte_pty_new_foreign_sync (shell->slave, NULL, NULL));
 	THREADS_LEAVE
 
 	remmina_plugin_service->protocol_plugin_emit_signal (gp, "connect");
@@ -169,7 +170,11 @@ remmina_plugin_ssh_set_vte_pref (Remmina
 	gpdata = (RemminaPluginSshData*) g_object_get_data (G_OBJECT(gp), "plugin-data");
 	if (remmina_pref.vte_font && remmina_pref.vte_font[0])
 	{
-		vte_terminal_set_font_from_string (VTE_TERMINAL (gpdata->vte), remmina_pref.vte_font);
+		PangoFontDescription *desc;
+
+		desc = pango_font_description_from_string (remmina_pref.vte_font);
+		vte_terminal_set_font (VTE_TERMINAL (gpdata->vte), desc);
+		pango_font_description_free (desc);
 	}
 	vte_terminal_set_allow_bold (VTE_TERMINAL (gpdata->vte), remmina_pref.vte_allow_bold_text);
 	if (remmina_pref.vte_lines > 0)
@@ -205,7 +210,7 @@ remmina_plugin_ssh_init (RemminaProtocol
 
 	remmina_plugin_service->protocol_plugin_register_hostkey (gp, vte);
 
-	vscrollbar = gtk_vscrollbar_new (vte_terminal_get_adjustment (VTE_TERMINAL (vte)));
+	vscrollbar = gtk_vscrollbar_new (gtk_scrollable_get_vadjustment(GTK_SCROLLABLE (vte)));
 	gtk_widget_show(vscrollbar);
 	gtk_box_pack_start (GTK_BOX (hbox), vscrollbar, FALSE, TRUE, 0);
 }
